---
layout: post
title: "分布式事务消息最终一致性解决方案"
keywords: ["distributed"]
description: "数据库事务隔离一致性"
category: "distributed"
tags: ["distributed","事务隔离一致性"]
---

最近面试了几位开发的同学，聊到消息最终一致性方案，有的完全没用过也没看过有的用过也说不清楚，但是这个比起GTS这些，算是几年前的老话题了,如是准备再理一理：



###  基于本地消息服务最终一致性方案
核心： 将业务逻辑与消息记录放在同一个事务里边执行， 业务逻辑执行与消息记录一致。
[!主要流程图](https://raw.githubusercontent.com/2pc/2pc.github.io/master/_posts/images/13.png)

### 基于独立消息服务的最终一致性方案

异常case： 业务执行成功或者失败，但是没有确定状态，导致中间件消息状态一直为"待处理"状态

###  RocketMQ类支持事务最终一致性方案



### 下游
#### 幂等问题：
下游消费服务，正常情况下都会ack消费消息的状态，但是也存在消息处理完之后一直没有ack消费状态的情况， 这时就会出现重复消费消息，如果之前业务没有执行成功， 重复消费是没有问题的

但是如果之前的消息业务逻辑处理成功了， 再次消费就可能出现问题了。所以这个时候就必须考虑幂等的问题
#### 回滚问题
